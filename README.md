# 实时语音翻译器

这是一个基于 Groq API 的实时语音翻译应用，支持多种语言的语音转录和翻译功能。

## 功能特性

### 🚀 智能分段处理 (新功能)
- **实时断句检测**: 自动识别语音停顿，智能分段录音
- **多线程异步处理**: 最多3个分段同时转录和翻译，大幅提升处理速度
- **流式结果显示**: 每个分段完成后立即显示，无需等待完整录音
- **智能队列管理**: 自动调度处理任务，确保最优性能

### ⚙️ 智能分段设置 (最新功能)
- **可视化参数调整**: 通过滑块直观调整所有分段参数
- **实时参数预览**: 调整参数时实时显示数值和说明
- **场景化配置**: 提供会议、对话、演讲等不同场景的推荐配置
- **本地存储保存**: 设置自动保存到浏览器，下次访问自动加载
- **一键重置**: 快速恢复默认设置

### 🎤 语音处理功能
- **实时连续转录**: 点击开始后自动检测语音，无需手动停止
- **语音活动检测**: 智能识别说话和静音状态
- **分段状态反馈**: 不同颜色和动画显示录音、转录、翻译状态
- **时间戳记录**: 每个分段都显示处理时间和分段编号

### ⚡ 异步处理机制
- **并发转录**: 多个音频分段同时进行转录处理
- **并发翻译**: 转录完成的分段立即开始翻译
- **实时状态**: 清晰的进度指示器显示处理状态
- **追加显示**: 转录和翻译结果追加显示，不会覆盖历史内容

### 🌍 多语言支持
- 支持80+种语言的自动识别和转录
- 自动语言检测
- 手动文本翻译
- 音频文件上传处理

### 💾 数据管理
- 异步数据库保存：自动保存所有转录和翻译记录
- 历史记录保存和查看
- 滚动查看所有历史结果
- WebSocket 实时通信

## 核心功能

### 实时连续转录
1. **点击"开始实时转录"** - 启动连续监听模式
2. **自动语音检测** - 系统持续监听，检测到说话声音时自动开始录音
3. **智能分段处理** - 检测到静音时自动停止录音并处理
4. **异步处理流程** - 转录完成立即显示，翻译异步进行
5. **连续工作** - 处理完一段语音后继续监听下一段

### 异步处理机制
1. **音频上传** - 音频文件立即上传到服务器
2. **转录优先** - 语音转录完成后立即显示原文
3. **并行翻译** - 转录完成的同时开始异步翻译
4. **实时更新** - 翻译完成后自动更新界面
5. **状态指示** - 清晰显示转录和翻译的进度状态

### 使用方法
1. 确保麦克风权限已授权
2. 选择源语言（可选自动检测）和目标语言
3. **（可选）调整智能分段设置**：
   - 点击"⚙️ 智能分段设置"展开设置面板
   - 根据使用场景调整参数（静音阈值、停顿检测时间等）
   - 点击"保存设置"保存配置
4. 点击"开始智能转录"按钮
5. 开始正常说话，无需手动控制录音
6. 系统会自动检测语音并实时显示转录翻译结果
7. 所有结果都会追加显示，带有时间戳和分段编号
8. 结果自动保存到数据库，可通过历史记录查看
9. 点击"停止智能转录"结束连续模式

### 智能分段状态指示
- **红色按钮**: 默认状态，点击开始智能转录
- **蓝色脉动**: 智能转录模式已启动，等待语音输入
- **绿色脉动**: 检测到语音活动
- **橙色脉动**: 正在录制分段，准备处理
- **分段标识**: 每个结果显示分段编号，便于跟踪处理进度

### 性能优势
相比传统方式，智能分段处理具有以下优势：
- ⚡ **处理速度提升**: 并发处理多个分段，整体速度提升3-5倍
- 🎯 **实时响应**: 边录边处理，用户体验更流畅
- 🔄 **资源优化**: 智能队列管理，避免系统过载
- 📊 **准确度提升**: 短分段处理，减少长音频的识别错误
- **转录中**: 正在进行语音转录
- **翻译中**: 转录完成，正在进行翻译
- **已完成**: 转录或翻译已完成

### 追加显示功能 (v2.0新增)
- **历史保留**: 所有转录和翻译结果都会保留在界面上，不会被新结果覆盖
- **时间戳**: 每个结果都显示处理时间，方便追踪对话流程
- **自动滚动**: 新结果出现时自动滚动到最新内容
- **异步保存**: 每次转录和翻译完成后自动保存到数据库
- **状态跟踪**: 每个结果项都有独立的处理状态显示
- **滚动查看**: 结果区域支持滚动，可以查看所有历史内容

## 技术栈

- **后端**: Node.js + Express + WebSocket
- **前端**: 原生 JavaScript + HTML5 + CSS3 + Web Audio API
- **AI服务**: Groq API (Whisper + LLaMA)
- **数据库**: SQLite

## 安装和使用

### 环境要求

- Node.js 16+
- npm 或 yarn
- Groq API Key

### 安装步骤

1. 克隆项目
```bash
git clone <repository-url>
cd voice-translator
```

2. 安装依赖
```bash
npm install
```

3. 配置环境变量
创建 `.env` 文件并添加：
```
GROQ_API_KEY=your_groq_api_key_here
```

4. 启动应用
```bash
npm start
```

5. 访问应用
打开浏览器访问 `http://localhost:3000`

## 使用说明

### 实时连续转录（推荐）
1. 点击"开始实时转录"按钮
2. 允许浏览器访问麦克风
3. 开始正常说话
4. 系统自动检测语音并实时转录翻译
5. 点击"停止实时转录"结束

### 手动翻译
1. 在文本框中输入要翻译的内容
2. 选择目标语言
3. 点击"翻译"按钮

### 音频文件上传
1. 点击"选择音频文件"
2. 选择支持的音频格式文件
3. 点击"转录并翻译"

## 智能分段参数设置

### 可调整参数
- **静音阈值 (0-100)**: 控制语音检测敏感度，默认30
- **停顿检测时间 (200-2000ms)**: 多长时间停顿后自动分段，默认800ms
- **最小分段时长 (200-3000ms)**: 过短分段会被忽略，默认1000ms
- **最大分段时长 (1-30秒)**: 防止单个分段过长，默认15秒
- **连续静音帧数 (3-20帧)**: 连续静音帧数后开始计时，默认8帧

### 场景推荐配置
- **电话会议**: 静音阈值35，停顿1200ms，最小1500ms，最大25秒
- **日常对话**: 静音阈值25，停顿600ms，最小800ms，最大12秒
- **演讲讲座**: 静音阈值30，停顿1500ms，最小2000ms，最大30秒
- **快速笔记**: 静音阈值20，停顿400ms，最小300ms，最大8秒
- **快速对话**: 静音阈值22，停顿300ms，最小250ms，最大5秒

### 设置方法
1. 点击"⚙️ 智能分段设置"按钮
2. 通过滑块调整各项参数
3. 观察实时数值和说明
4. 点击"保存设置"永久保存
5. 点击"恢复默认"重置所有参数

## 支持的语言

- 中文 (zh)
- English (en)
- 日本語 (ja)
- 한국어 (ko)
- Français (fr)
- Deutsch (de)
- Español (es)

## 浏览器兼容性

- Chrome 60+
- Firefox 55+
- Safari 11+
- Edge 79+

## 注意事项

- 需要在 HTTPS 环境或 localhost 下使用麦克风功能
- 首次使用需要授权麦克风权限
- 音频文件大小建议不超过 25MB
- 支持的音频格式：WebM, MP4, WAV, MP3
- 实时转录模式下建议在安静环境中使用以获得最佳效果

## API 接口

### WebSocket 消息格式

发送消息：
```json
{
  "type": "translate",
  "text": "要翻译的文本",
  "targetLanguage": "zh"
}
```

接收消息：
```json
{
  "type": "translationResult",
  "original": "原文",
  "translated": "翻译结果",
  "targetLanguage": "zh"
}
```

### HTTP API

- `GET /api/history` - 获取历史记录
- `POST /api/upload-audio` - 上传音频文件
- `GET /api/settings/:key` - 获取设置
- `POST /api/settings` - 保存设置

## 开发

### 项目结构
```
├── app.js              # 主应用文件
├── voice-service.js    # 语音服务
├── database.js         # 数据库操作
├── audio-upload.js     # 音频上传处理
├── public/             # 前端文件
│   ├── index.html      # 主页面
│   ├── app.js          # 前端逻辑
│   ├── audio-recorder.js # 音频录制和VAD
│   └── style.css       # 样式文件
└── uploads/            # 上传文件目录
```

### 启动开发模式
```bash
npm run dev
```

## 许可证

MIT License